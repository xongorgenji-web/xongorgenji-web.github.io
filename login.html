<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login ‚Äì Reselling & Buying</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-card{
  width:100%;
  max-width:380px;
  background:#fff;
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,0.25);
}
.brand{text-align:center;margin-bottom:20px;}
.brand .logo{font-size:14px;letter-spacing:2px;color:#ffb703;font-weight:bold;}
.brand h1{margin:6px 0 0;font-size:26px;}
.brand p{margin-top:6px;font-size:14px;color:#555;}
.roles{display:flex;gap:12px;margin:16px 0;}
.roles button{
  flex:1;padding:12px;border-radius:14px;
  border:2px solid #ddd;background:#fafafa;
  font-weight:bold;cursor:pointer;
}
.roles button.active{
  border-color:#ff9900;background:#fff3e0;
}
input{
  width:100%;padding:14px;margin-top:10px;
  border-radius:14px;border:1px solid #ddd;
  background:#fafafa;
}
input:focus{
  outline:none;border-color:#ff9900;
  box-shadow:0 0 0 2px rgba(255,153,0,.25);
}
.main-btn{
  width:100%;margin-top:16px;padding:14px;
  border:none;border-radius:16px;
  background:linear-gradient(135deg,#ff9900,#ffb703);
  font-size:16px;font-weight:bold;cursor:pointer;
}
.secondary-btn{
  width:100%;margin-top:10px;padding:14px;
  border:none;border-radius:16px;
  background:#f1f3f6;font-weight:bold;cursor:pointer;
}
.terms{display:flex;gap:8px;margin-top:12px;font-size:13px;}
.terms a{color:#ff9900;text-decoration:underline;cursor:pointer;}
.message{
  margin-top:12px;padding:10px;border-radius:10px;
  font-size:14px;display:none;
}
.success{background:#d4edda;color:#155724}
.error{background:#f8d7da;color:#721c24}
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,0.6);
  display:none;justify-content:center;align-items:center;
}
.modal-box{
  background:#fff;padding:20px;
  max-width:420px;border-radius:16px;
}
.modal-box button{
  margin-top:12px;width:100%;
  padding:12px;border:none;
  border-radius:12px;background:#ff9900;font-weight:bold;
}
</style>
</head>

<body>

<div class="login-card">

  <div class="brand">
    <div class="logo">üåÄ GENJIXONGOR</div>
    <h1>Reselling & Buying</h1>
    <p>Login or create your account</p>
  </div>

  <div class="roles">
    <button id="buyerBtn" onclick="selectRole('buyer')">üõçÔ∏è Buyer</button>
    <button id="sellerBtn" onclick="selectRole('seller')">üì¶ Seller</button>
  </div>

  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">

  <!-- Forgot Password -->
  <p id="forgotPassword" style="
    text-align:right;
    margin-top:6px;
    font-size:13px;
    color:#ff9900;
    cursor:pointer;">
    Forgot password?
  </p>

  <div class="terms">
    <input type="checkbox" id="agree">
    <span>I agree to the <a onclick="openTerms()">Terms</a></span>
  </div>

  <div id="msg" class="message"></div>

  <button class="main-btn" onclick="login()">Login</button>
  <button class="secondary-btn" onclick="register()">Create Account</button>

</div>

<div class="modal" id="termsModal">
  <div class="modal-box">
    <h3>Terms & Conditions</h3>
    <p>
      This platform connects buyers and sellers.<br><br>
      Sellers are responsible for their products.<br><br>
      Buyers must verify product details.<br><br>
      Fraud or misuse will result in account termination.
    </p>
    <button onclick="closeTerms()">Close</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCk8AopowtdPEZeYXsnEiT1o85kngAgG0Y",
  authDomain:"genji-store.firebaseapp.com",
  projectId:"genji-store"
});

const auth = firebase.auth();
const db = firebase.firestore();
let role = null;

function selectRole(r){
  role = r;
  buyerBtn.classList.remove("active");
  sellerBtn.classList.remove("active");
  if(r==="buyer") buyerBtn.classList.add("active");
  if(r==="seller") sellerBtn.classList.add("active");
}

function showMsg(text,type){
  msg.innerText = text;
  msg.className = "message " + type;
  msg.style.display = "block";
}

function openTerms(){ termsModal.style.display="flex"; }
function closeTerms(){ termsModal.style.display="none"; }

function valid(){
  if(!role){ showMsg("Select Buyer or Seller","error"); return false; }
  if(!agree.checked){ showMsg("Accept terms first","error"); return false; }
  if(!email.value || !password.value){
    showMsg("Enter email & password","error"); return false;
  }
  return true;
}

function register(){
  if(!valid()) return;
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .then(async cred=>{
    await db.collection("users").doc(cred.user.uid).set({
      role:role,
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    showMsg("Account created successfully","success");
    setTimeout(()=>location.replace(
      role==="seller"?"seller.html":"index.html"),1200);
  })
  .catch(e=>showMsg(e.message,"error"));
}

function login(){
  if(!valid()) return;
  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(async cred=>{
    const doc = await db.collection("users")
      .doc(cred.user.uid).get();
    if(!doc.exists || doc.data().role!==role){
      showMsg("Role mismatch","error");
      auth.signOut(); return;
    }
    showMsg("Login successful","success");
    setTimeout(()=>location.replace(
      role==="seller"?"seller.html":"index.html"),1000);
  })
  .catch(e=>showMsg(e.message,"error"));
}

/* üî• FINAL PASSWORD RESET ‚Äì GUARANTEED */
document.getElementById("forgotPassword").addEventListener("click",()=>{
  if(!email.value){
    showMsg("Please enter your email first","error");
    return;
  }

  auth.sendPasswordResetEmail(email.value,{
    url:"https://xongorgenji-web.github.io",
    handleCodeInApp:false
  })
  .then(()=>{
    showMsg("Password reset link sent to your email üì©","success");
  })
  .catch(e=>showMsg(e.message,"error"));
});
</script>

</body>
</html>
