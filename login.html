<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login – Genji Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,0.25);
}

h1{text-align:center;margin-top:0}

input,select{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:14px;
  border:1px solid #ddd;
}

button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-weight:bold;
  cursor:pointer;
}

.primary{background:#ff9900;color:#fff}
.secondary{background:#f1f3f6}

.toggle{
  text-align:center;
  margin-top:12px;
  color:#ff9900;
  font-weight:bold;
  cursor:pointer;
}

.terms{
  display:flex;
  gap:8px;
  margin-top:12px;
  font-size:13px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-box{
  background:#fff;
  padding:20px;
  max-width:420px;
  border-radius:16px;
}
</style>
</head>

<body>

<div class="card">

<h1 id="title">Login</h1>

<!-- REGISTER FIELDS -->
<div id="registerFields" style="display:none">

  <select id="titleInput">
    <option>Mr</option>
    <option>Ms</option>
    <option>Mrs</option>
  </select>

  <input id="name" placeholder="Full Name">
  <input id="phone" placeholder="Phone Number">
  <input id="state" placeholder="State">

</div>

<!-- COMMON -->
<input id="email" type="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">

<input id="confirmPassword"
       type="password"
       placeholder="Confirm Password"
       style="display:none">

<label style="font-size:13px;">
  <input type="checkbox" onclick="togglePassword()"> Show Password
</label>

<!-- FORGOT PASSWORD -->
<p id="forgotPassword"
   style="text-align:right;font-size:13px;color:#ff9900;cursor:pointer;">
   Forgot password?
</p>

<!-- TERMS -->
<div class="terms" id="termsBox" style="display:none">
  <input type="checkbox" id="agree">
  <span>I agree to the <a onclick="openTerms()" style="cursor:pointer">Terms</a></span>
</div>

<button class="primary" id="actionBtn"
        onclick="submitForm()">Login</button>

<div class="toggle" onclick="toggleMode()">
  Create Account
</div>

</div>

<!-- TERMS MODAL -->
<div class="modal" id="termsModal">
  <div class="modal-box">
    <h3>Terms & Conditions</h3>

    <p style="font-size:14px;line-height:1.6">

      This platform connects buyers and independent sellers.

      <br><br>

      • Genji Store does NOT handle payments between buyers and sellers.
      <br>
      • Buyers must verify product details before purchasing.
      <br>
      • All transactions occur directly between buyer and seller.

      <br><br>

      • Sellers are fully responsible for their products, pricing, and delivery.
      <br>
      • Genji Store is not liable for fraud, disputes, damages, or losses.

      <br><br>

      • Seller access requires a one-time fee of ₹49.
      <br>
      • The seller fee is non-refundable.
      <br>
      • Seller accounts are granted after verification and approval.

      <br><br>

      • Misuse, spam, illegal activity, or fraud will result in account termination.
      <br>
      • Genji Store reserves the right to suspend any account.

      <br><br>

      By creating an account, you agree to these terms.

    </p>

    <button onclick="closeTerms()">Close</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCk8AopowtdPEZeYXsnEiT1o85kngAgG0Y",
  authDomain:"genji-store.firebaseapp.com",
  projectId:"genji-store"
});

const auth=firebase.auth();
const db=firebase.firestore();

let registerMode=false;

/* SWITCH MODE */
function toggleMode(){

  registerMode=!registerMode;

  registerFields.style.display =
    registerMode ? "block" : "none";

  confirmPassword.style.display =
    registerMode ? "block" : "none";

  termsBox.style.display =
    registerMode ? "flex" : "none";

  title.innerText =
    registerMode ? "Create Account" : "Login";

  actionBtn.innerText =
    registerMode ? "Register" : "Login";

  document.querySelector(".toggle").innerText =
    registerMode ? "Back to Login" : "Create Account";
}

/* SHOW PASSWORD */
function togglePassword(){
  const type =
    password.type==="password" ? "text" : "password";
  password.type = type;
  confirmPassword.type = type;
}

/* TERMS */
function openTerms(){termsModal.style.display="flex";}
function closeTerms(){termsModal.style.display="none";}

/* FORGOT PASSWORD */
forgotPassword.onclick = () => {
  if(!email.value){
    alert("Enter your email first");
    return;
  }
  auth.sendPasswordResetEmail(email.value)
    .then(()=>alert("Password reset email sent"));
};

/* SUBMIT */
function submitForm(){

  if(!registerMode){

    // LOGIN
    auth.signInWithEmailAndPassword(
      email.value, password.value
    )
    .then(()=>location.href="index.html")
    .catch(e=>alert(e.message));

    return;
  }

  // REGISTER VALIDATION
  if(!agree.checked){
    alert("Accept terms first");
    return;
  }

  if(password.value !== confirmPassword.value){
    alert("Passwords do not match");
    return;
  }

  auth.createUserWithEmailAndPassword(
    email.value, password.value
  )
  .then(async cred=>{

    await db.collection("users")
      .doc(cred.user.uid)
      .set({
        title: titleInput.value,
        name: name.value,
        phone: phone.value,
        state: state.value,
        email: email.value,
        role: "buyer",
        createdAt:
          firebase.firestore.FieldValue.serverTimestamp()
      });

    alert("Account created!");
    location.href="index.html";

  })
  .catch(e=>alert(e.message));

}
</script>

</body>
</html>