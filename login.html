<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Login – Genji Store</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,0.25);
}
h1{text-align:center;margin-top:0}
input,select{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:14px;
  border:1px solid #ddd;
}
button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-weight:bold;
  cursor:pointer;
}
.primary{background:#ff9900;color:#fff}
.toggle{
  text-align:center;
  margin-top:12px;
  color:#ff9900;
  font-weight:bold;
  cursor:pointer;
}
.terms{
  display:flex;
  gap:8px;
  margin-top:12px;
  font-size:13px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal-box{
  background:#fff;
  padding:20px;
  max-width:420px;
  border-radius:16px;
}
</style>
</head>

<body>

<div class="card">

<h1 id="pageTitle">Login</h1>

<!-- REGISTER FIELDS -->
<div id="registerFields" style="display:none">

  <select id="titleInput">
    <option>Mr</option>
    <option>Ms</option>
    <option>Mrs</option>
  </select>

  <input id="nameInput" placeholder="Full Name">
  <input id="phoneInput" placeholder="Phone Number">
  <input id="stateInput" placeholder="State">

</div>

<!-- COMMON -->
<input id="emailInput" type="email" placeholder="Email">
<input id="passwordInput" type="password" placeholder="Password">

<input id="confirmPasswordInput"
type="password"
placeholder="Confirm Password"
style="display:none">

<label style="font-size:13px;">
  <input type="checkbox" id="showPass"> Show Password
</label>

<p id="forgotPassword"
style="text-align:right;font-size:13px;color:#ff9900;cursor:pointer;">
Forgot password?
</p>

<div class="terms" id="termsBox" style="display:none">
  <input type="checkbox" id="agreeCheck">
  <span>I agree to the <a id="termsLink" style="cursor:pointer">Terms</a></span>
</div>

<button class="primary" id="actionBtn">Login</button>

<div class="toggle" id="toggleText">Create Account</div>

</div>

<!-- TERMS MODAL -->
<div class="modal" id="termsModal">
  <div class="modal-box">
    <h3>Terms & Conditions</h3>
    <p style="font-size:14px;line-height:1.6">
      This platform connects buyers and independent sellers.<br><br>
      Seller access requires a one-time fee of ₹49.<br>
      The seller fee is non-refundable.<br><br>
      By creating an account, you agree to these terms.
    </p>
    <button id="closeTerms">Close</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCk8AopowtdPEZeYXsnEiT1o85kngAgG0Y",
  authDomain:"genji-store.firebaseapp.com",
  projectId:"genji-store"
});

const auth = firebase.auth();
const db = firebase.firestore();

let registerMode = false;

/* ELEMENTS */
const pageTitle = document.getElementById("pageTitle");
const registerFields = document.getElementById("registerFields");
const confirmPasswordInput = document.getElementById("confirmPasswordInput");
const termsBox = document.getElementById("termsBox");
const toggleText = document.getElementById("toggleText");
const actionBtn = document.getElementById("actionBtn");

/* SWITCH MODE */
toggleText.onclick = () => {

  registerMode = !registerMode;

  registerFields.style.display = registerMode ? "block" : "none";
  confirmPasswordInput.style.display = registerMode ? "block" : "none";
  termsBox.style.display = registerMode ? "flex" : "none";

  pageTitle.textContent = registerMode ? "Create Account" : "Login";
  actionBtn.textContent = registerMode ? "Register" : "Login";
  toggleText.textContent = registerMode ? "Back to Login" : "Create Account";
};

/* SHOW PASSWORD */
document.getElementById("showPass").onchange = () => {

  const pwd = document.getElementById("passwordInput");
  const cpwd = confirmPasswordInput;

  const type = pwd.type === "password" ? "text" : "password";
  pwd.type = type;
  cpwd.type = type;
};

/* TERMS MODAL */
document.getElementById("termsLink").onclick =
  () => document.getElementById("termsModal").style.display = "flex";

document.getElementById("closeTerms").onclick =
  () => document.getElementById("termsModal").style.display = "none";

/* FORGOT PASSWORD */
document.getElementById("forgotPassword").onclick = () => {

  const email = document.getElementById("emailInput").value.trim();

  if(!email){
    alert("Enter your email first");
    return;
  }

  auth.sendPasswordResetEmail(email)
    .then(()=>alert("Password reset email sent"))
    .catch(e=>alert(e.message));
};

/* SUBMIT */
actionBtn.onclick = async () => {

  const email = document.getElementById("emailInput").value.trim();
  const password = document.getElementById("passwordInput").value;

  if(!email || !password){
    alert("Enter email and password");
    return;
  }

  try{

    /* LOGIN */
    if(!registerMode){

      await auth.signInWithEmailAndPassword(email, password);
      alert("Login successful!");
      location.href="index.html";
      return;
    }

    /* REGISTER */
    const name = document.getElementById("nameInput").value.trim();
    const phone = document.getElementById("phoneInput").value.trim();
    const state = document.getElementById("stateInput").value.trim();
    const confirmPassword = confirmPasswordInput.value;

    if(!name || !phone || !state){
      alert("Please fill all fields");
      return;
    }

    if(password !== confirmPassword){
      alert("Passwords do not match");
      return;
    }

    if(!document.getElementById("agreeCheck").checked){
      alert("Accept terms first");
      return;
    }

    const cred =
      await auth.createUserWithEmailAndPassword(email, password);

    await db.collection("users").doc(cred.user.uid).set({
      title: document.getElementById("titleInput").value,
      name,
      phone,
      state,
      email,
      role: "buyer",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("✅ Account created successfully!");
    location.href="index.html";

  }catch(e){
    alert(e.message);
  }

};
</script>

</body>
</html>