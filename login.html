<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GenjiStore â€” Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:100%;
  max-width:420px;
  background:#fff;
  border-radius:20px;
  padding:24px;
  box-shadow:0 20px 40px rgba(0,0,0,0.25);
}

.tagline{
  text-align:center;
  color:#666;
  margin-bottom:12px;
  font-weight:600;
}

.input-group{
  position:relative;
  margin-top:10px;
}

input{
  width:100%;
  padding:14px;
  padding-right:44px; /* space for eye */
  border-radius:14px;
  border:1px solid #ddd;
}

.eye{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  font-size:18px;
  user-select:none;
}

button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  font-weight:bold;
  cursor:pointer;
  background:#9c27b0;
  color:#fff;
}

.toggle{
  text-align:center;
  margin-top:12px;
  color:#9c27b0;
  font-weight:bold;
  cursor:pointer;
}

.terms{
  display:flex;
  gap:8px;
  margin-top:12px;
  font-size:13px;
}
</style>
</head>

<body>

<div class="card">

<h1 style="text-align:center">GenjiStore</h1>
<div class="tagline">Genjistore ka iew khasi online</div>

<!-- REGISTER FIELDS -->
<div id="registerFields" style="display:none">
  <input id="nameInput" placeholder="Full Name">
  <input id="phoneInput" placeholder="Phone Number">
  <input id="stateInput" placeholder="State">
</div>

<input id="emailInput" type="email" placeholder="Email">

<!-- PASSWORD -->
<div class="input-group">
  <input id="passwordInput" type="password" placeholder="Password">
  <span class="eye" onclick="togglePass('passwordInput')"></span>
</div>

<!-- CONFIRM PASSWORD -->
<div class="input-group" id="confirmGroup" style="display:none">
  <input id="confirmPasswordInput" type="password" placeholder="Confirm Password">
  <span class="eye" onclick="togglePass('confirmPasswordInput')"></span>
</div>

<!-- TERMS -->
<div class="terms" id="termsBox" style="display:none">
  <input type="checkbox" id="agreeCheck">
  <span>I agree to the Terms & Conditions</span>
</div>

<button id="actionBtn">Login</button>

<div class="toggle" id="toggleText">Create Account</div>

</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCk8AopowtdPEZeYXsnEiT1o85kngAgG0Y",
  authDomain:"genji-store.firebaseapp.com",
  projectId:"genji-store"
});

const auth = firebase.auth();
const db = firebase.firestore();

let registerMode=false;

/* SWITCH MODE */
toggleText.onclick = () => {

  registerMode = !registerMode;

  registerFields.style.display = registerMode ? "block" : "none";
  confirmGroup.style.display = registerMode ? "block" : "none";
  termsBox.style.display = registerMode ? "flex" : "none";

  actionBtn.textContent = registerMode ? "Register" : "Login";
  toggleText.textContent = registerMode ? "Back to Login" : "Create Account";
};

/* PASSWORD TOGGLE */
function togglePass(id){
  const input = document.getElementById(id);
  input.type = input.type === "password" ? "text" : "password";
}

/* SUBMIT */
actionBtn.onclick = async () => {

  const email = emailInput.value.trim();
  const password = passwordInput.value;

  if(!email || !password){
    alert("Enter email and password");
    return;
  }

  try{

    if(!registerMode){
      await auth.signInWithEmailAndPassword(email, password);
      location.href="index.html";
      return;
    }

    const name = nameInput.value.trim();
    const phone = phoneInput.value.trim();
    const state = stateInput.value.trim();
    const confirmPassword = confirmPasswordInput.value;

    if(!name || !phone || !state){
      alert("Please fill all fields");
      return;
    }

    if(password !== confirmPassword){
      alert("Passwords do not match");
      return;
    }

    if(!agreeCheck.checked){
      alert("Please accept the Terms & Conditions first");
      return;
    }

    const cred =
      await auth.createUserWithEmailAndPassword(email, password);

    await db.collection("users").doc(cred.user.uid).set({
      name, phone, state, email,
      role:"buyer",
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("Account created successfully ");
    location.href="index.html";

  }catch(e){
    alert(e.message);
  }

};
</script>

</body>
</html>